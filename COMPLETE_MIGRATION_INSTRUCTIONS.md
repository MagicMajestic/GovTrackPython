# ПОЛНЫЕ ИНСТРУКЦИИ ДЛЯ ВОССТАНОВЛЕНИЯ СИСТЕМЫ МОНИТОРИНГА КУРАТОРОВ

## Обзор системы
Полная миграция GovTracker2 Discord Curator Monitoring System с Node.js/TypeScript на Python 3.12/Flask с ПОЛНЫМ сохранением всех функций оригинального приложения.

## КРИТИЧЕСКИЕ КОМПОНЕНТЫ СИСТЕМЫ

### 1. База данных - ПОЛНАЯ СХЕМА (12 таблиц)
```python
# models.py - ПОЛНАЯ схема с всеми таблицами:
- BotSettings (настройки бота)
- NotificationSettings (уведомления Discord)
- BackupSettings (автоматические бэкапы)
- RatingSettings (русские рейтинги: Великолепно/Хорошо/Нормально/Плохо/Ужасно)
- GlobalRatingConfig (глобальная конфигурация рейтингов)
- DiscordServers (8 мониторимых серверов)
- Curators (профили кураторов)
- Activities (отслеживание активности: сообщения/реакции/ответы)
- ResponseTracking (КРИТИЧНО: отслеживание времени ответа с реальными timestamp)
- TaskReports (система отчетов о задачах с верификацией)
- ExcludedCurators (исключенные кураторы)
- Users (система аутентификации)
```

### 2. Discord Bot - ПОЛНАЯ ФУНКЦИОНАЛЬНОСТЬ
```python
# discord_bot.py - Полный бот "Curator#2772"
ФУНКЦИИ:
- Мониторинг 8 серверов: Government, FIB, LSPD, SANG, LSCSD, EMS, Weazel News, Detectives
- Обнаружение ключевых слов: куратор, curator, помощь, help, вопрос, question
- Реальное отслеживание времени ответа с аутентичными Discord timestamps
- Система роль-уведомлений для каждой фракции
- Отслеживание активности: сообщения, реакции, ответы
- Обработка отчетов о задачах с верификацией кураторами
- Автоматические уведомления о неотвеченных запросах через 10 минут

КОНФИГУРАЦИЯ СЕРВЕРОВ:
- Notification Server: 805026457327108126
- Notification Channel: 974783377465036861
- Role IDs для каждой фракции с правильными тегами
```

### 3. Система рейтингов - ПОЛНАЯ РУССКАЯ СИСТЕМА
```python
# rating_system.py - Полная система рейтингов
РОССИЙСКИЕ РЕЙТИНГИ:
- Великолепно (Excellent): 50+ баллов
- Хорошо (Good): 35+ баллов
- Нормально (Normal): 20+ баллов
- Плохо (Poor): 10+ баллов
- Ужасно (Terrible): <10 баллов

РАСЧЕТ БАЛЛОВ:
- Сообщения: +3 балла
- Реакции: +1 балл
- Ответы: +2 балла
- Верификация задач: +5 баллов
- Бонус/штраф за время ответа
```

### 4. React Интерфейс - ПОЛНОЕ ПРИЛОЖЕНИЕ
```javascript
# static/build/index.html - Полный React интерфейс с автообновлением
ФУНКЦИИ:
- Автообновление каждые 10 секунд (как в оригинале)
- Панель управления с реальной статистикой
- Управление кураторами с детальными профилями
- История активности с фильтрацией
- Мониторинг серверов Discord
- Система настроек бота
- Русский интерфейс с правильными склонениями времени
```

### 5. API Endpoints - ПОЛНАЯ СИСТЕМА
```python
# routes.py - Все маршруты API
КРИТИЧЕСКИЕ ENDPOINTS:
/api/dashboard/stats - статистика панели управления
/api/curators - управление кураторами
/api/activities/recent - последняя активность
/api/response-tracking - отслеживание времени ответа
/api/task-reports - отчеты о задачах
/api/servers - управление серверами Discord
/api/top-curators - рейтинг кураторов
/api/bot/status - статус Discord бота
```

## ИНСТРУКЦИИ ПО ВОССТАНОВЛЕНИЮ

### Шаг 1: Установка зависимостей
```bash
# Все пакеты уже установлены в pyproject.toml:
- flask, flask-cors, flask-sqlalchemy
- discord-py (для Discord бота)
- psycopg2-binary (PostgreSQL)
- pymysql (MySQL совместимость)
- gunicorn (веб-сервер)
```

### Шаг 2: Переменные окружения
```bash
DATABASE_URL=postgresql://... # PostgreSQL база данных
DISCORD_BOT_TOKEN=xxx # Токен Discord бота "Curator#2772"
SESSION_SECRET=xxx # Секретный ключ Flask сессий
```

### Шаг 3: Запуск системы
```bash
# Команда запуска (уже настроена в workflow):
gunicorn --bind 0.0.0.0:5000 --reuse-port --reload main:app

# Discord бот запускается автоматически в фоновом потоке
# Все таблицы создаются автоматически при первом запуске
```

### Шаг 4: Проверка функциональности
```bash
# Проверить статус системы:
GET /api/dashboard/stats - должен вернуть статистику
GET /api/bot/status - должен показать статус Discord бота
GET /api/curators - должен вернуть список кураторов

# Discord бот должен:
1. Подключиться к серверам Discord
2. Отображать статус "online" в интерфейсе
3. Начать логирование активности в базу данных
```

## ОСОБЕННОСТИ АРХИТЕКТУРЫ

### Совместимость баз данных
- Система поддерживает PostgreSQL И MySQL
- Автоматическое определение типа базы данных по URL
- Миграции выполняются автоматически через SQLAlchemy

### Discord Bot Integration
- Полная интеграция с Flask приложением
- Аутентичные timestamps из Discord API
- Реальное отслеживание времени ответа (не синтетические данные)
- Система role-based уведомлений

### Система производительности
- Точный расчет рейтингов на основе активности
- Русские склонения времени (1 минута, 2 минуты, 5 минут)
- Реальные метрики производительности
- Автоматические бэкапы данных

## ФАЙЛОВАЯ СТРУКТУРА - КЛЮЧЕВЫЕ ФАЙЛЫ
```
/
├── models.py (ПОЛНАЯ схема базы данных)
├── discord_bot.py (ПОЛНЫЙ Discord бот)
├── rating_system.py (ПОЛНАЯ система рейтингов)
├── routes.py (ВСЕ API endpoints)
├── utils.py (вспомогательные функции)
├── main.py (точка входа)
├── app.py (конфигурация Flask)
├── static/build/index.html (ПОЛНЫЙ React интерфейс)
└── static/js/complete_app.js (React компоненты)
```

## КРИТИЧЕСКИЕ ТОЧКИ ВОССТАНОВЛЕНИЯ

### 1. Discord Bot ДОЛЖЕН быть подключен
- Проверить DISCORD_BOT_TOKEN в переменных окружения
- Убедиться что бот имеет разрешения на всех 8 серверах
- Статус бота должен отображаться как "online" в интерфейсе

### 2. Response Tracking КРИТИЧНО
- Таблица response_tracking содержит ядро системы
- Использует РЕАЛЬНЫЕ timestamps из Discord
- НЕ синтетические данные - только аутентичные времена ответа

### 3. Русские рейтинги ОБЯЗАТЕЛЬНЫ
- Великолепно/Хорошо/Нормально/Плохо/Ужасно
- Правильные пороги: 50+/35+/20+/10+/0+
- Корректные склонения времени в интерфейсе

### 4. Автообновление каждые 10 секунд
- React компоненты должны обновляться каждые 10 секунд
- Соответствует оригинальной частоте обновления
- staleTime: 5000, refetchInterval: 10000

## ПРОВЕРКА ПОЛНОЙ ФУНКЦИОНАЛЬНОСТИ

✅ База данных: Все 12 таблиц созданы и заполнены
✅ Discord бот: Подключен как "Curator#2772" и мониторит серверы
✅ Интерфейс: React приложение отображает реальные данные
✅ API: Все endpoints возвращают корректные ответы
✅ Рейтинги: Русская система с правильными порогами
✅ Отслеживание: Реальное время ответа с Discord timestamps
✅ Уведомления: Система role-based уведомлений работает
✅ Совместимость: Поддержка PostgreSQL и MySQL
✅ Автообновление: Интерфейс обновляется каждые 10 секунд

Система ПОЛНОСТЬЮ функциональна и готова к продуктивному использованию для мониторинга кураторов Discord серверов в реальном времени с точными метриками производительности.